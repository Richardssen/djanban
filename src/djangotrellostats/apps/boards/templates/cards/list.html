{% extends "boards/view.html" %}

{% block page_title %}Cards of {{board.name}}{% endblock %}

{% block content %}
    <h1>Cards of {{board.name}}</h1>
    <div>Last updated: {{board.get_human_fetch_datetime}}</div>
    {% if cards|length == 0 %}
        There are no cards in this board. Have you tried to fetch the cards?
    {% else %}
        <div class="row">
            <div class="col-sm-6">
                <a href="{% url 'charts:avg_time_by_list' board.id %}" title="Average time a card is in each list">
                    <img src="{% url 'charts:avg_time_by_list' board.id %}" alt="Average time a card is in each list"/>
                </a>
            </div>
            <div class="col-sm-6">
                <a href="{% url 'charts:avg_estimated_time_by_list' board.id %}" title="Average estimated time a card is in each list">
                    <img src="{% url 'charts:avg_estimated_time_by_list' board.id %}" alt="Average estimated time a card is in each list"/>
                </a>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <a href="{% url 'charts:number_of_cards_worked_on_by_month' board.id %}" title="Tasks worked on by month">
                    <img src="{% url 'charts:number_of_cards_worked_on_by_month' board.id %}" alt="Tasks worked on by month"/>
                </a>
            </div>
            <div class="col-sm-6">
                <a href="{% url 'charts:number_of_cards_worked_on_by_week' board.id %}" title="Tasks worked on by week">
                    <img src="{% url 'charts:number_of_cards_worked_on_by_week' board.id %}" alt="Tasks worked on by week"/>
                </a>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <a href="{% url 'charts:cumulative_list_evolution' board.id %}" title="Evolution of number of tasks by list">
                    <img src="{% url 'charts:cumulative_list_evolution' board.id %}" alt="Evolution of number of tasks by list"/>
                </a>
            </div>
             <div class="col-sm-6">
                <a href="{% url 'charts:cumulative_card_evolution' board.id %}" title="Evolution of number of tasks thru time">
                    <img src="{% url 'charts:cumulative_card_evolution' board.id %}" alt="Evolution of number of tasks thru time"/>
                </a>
            </div>
        </div>
        <div class="row">
            <div class="panel col-md-12">
                <div>
                    <a href="{% url 'boards:export_card_report' board.id %}" class="btn btn-primary">Export as CSV</a>
                </div>
                <table class="table">
                    <tr>
                        <td>Name</td>
                        <td>Closed?</td>
                        <td>List</td>
                        <td>Comments</td>
                        <td>Lead time</td>
                        <td>Cycle time</td>
                        <td>Spent/Estimated time</td>
                        <td>Last activity date</td>
                        <td>Actions</td>
                    </tr>
                    {% for card in cards %}
                        <tr>
                            <td>
                                <a href="{% url 'boards:view_card' board.id card.id %}" title="View card {{card.name}}">
                                    {{card.name}}
                                </a>
                            </td>
                            <td>{% if card.is_closed %}Yes{% else %}No{% endif %}</td>
                            <td>{{card.list.name}}</td>
                            <td>{{card.number_of_comments}}</td>
                            <td>{% if card.lead_time %}{{card.lead_time|floatformat:-2}}{% endif %}</td>
                            <td>{% if card.cycle_time %}{{card.cycle_time|floatformat:-2}}{% endif %}</td>
                            <td>{% if card.spent_time or card.estimated_time %}{{card.spent_time|floatformat:-2}}/{{card.estimated_time|floatformat:-2}}{% endif %}</td>
                            <td>{{card.last_activity_datetime}}</td>
                            <td>
                                <a href="{% url 'boards:view_card' board.id card.id %}" title="View card {{card.name}}">
                                    <span class="fa fa-eye"></span>
                                </a>
                                <a href="{{card.short_url}}" title="View card in Trello">
                                    <span class="fa fa-trello"></span>
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                    <tr>
                        <td colspan="6">Cycle time (avg. & std. dev.)</td><td>{{avg_cycle_time|floatformat:"-3"}}</td><td>{{std_dev_cycle_time|floatformat:"-3"}}</td>
                    </tr>
                    <tr>
                        <td colspan="6">Lead time (avg. & std. dev.)</td><td>{{avg_lead_time|floatformat:"-3"}}</td><td>{{std_dev_lead_time|floatformat:"-3"}}</td>
                    </tr>
                </table>
            </div>
        </div>
    {% endif %}
{% endblock content %}