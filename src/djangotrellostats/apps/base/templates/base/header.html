{% load staticfiles %}
{% load boards %}
{% load async_include %}

<div id="header">
    <div id="header_logo">
        <a href="{% url 'index' %}" title="Go to index">
            {# 393 x 123 image #}
            {% if board and board.header_image %}
                <img id="header_image" src="{{board.header_image.url}}" alt="{{board.name}}'s logo" />
            {% else %}
                <img id="header_image" src="{% static 'img/logo.png' %}" alt="Trello Stats Logo" />
            {% endif %}
        </a>
    </div>
    {% if user %}
        {% with url_name=request.resolver_match.url_name url_namespace=request.resolver_match.namespace %}
            <ul class="nav nav-tabs ">
                <li role="presentation" {% if url_name == "index" and url_namespace == "" %}class="active"{% endif %}>
                    <a href="{% url 'index' %}" title="Go to index">
                        <span class="fa fa-home"></span>
                    </a>
                </li>
                {% if user and user.is_authenticated %}
                    <li role="presentation" {% if url_name == "view_boards" %}class="active"{% endif %}>
                       <a href="{% url 'boards:view_boards' %}" title="View my boards">
                           <span class="fa fa-tasks"></span>
                       </a>
                    </li>
                    <li role="presentation" {% if url_name == "view_board_panorama" %}class="active"{% endif %}>
                       <a href="{% url 'boards:view_board_panorama' %}" title="View project summary">
                           <span class="fa fa-line-chart"></span>
                       </a>
                    </li>
                    {% if member %}
                        <li role="presentation" {% if url_name == "view_members" or url_name == "view_spent_time_factors" %}class="active"{% endif %}>
                            <a href="{% url 'members:view_members' %}" title="View members">
                                <span class="fa fa-users"></span>
                            </a>
                        </li>
                        <li role="presentation" {% if url_namespace == "reports" %}class="active"{% endif %}>
                            <a href="{% url 'reports:view_report_recipients' %}" title="View report recipients">
                                <span class="fa fa-at"></span>
                            </a>
                        </li>
                        <li role="presentation" {% if url_namespace == "dev_environment"  %}class="active"{% endif %}>
                            <a href="{% url 'dev_environment:index' %}" title="View software development environment">
                                <span class="fa fa-building-o"></span> Env.
                            </a>
                        </li>
                        <li role="presentation" {% if url_namespace == "niko_niko_calendar" %}class="active"{% endif %}>
                            <a href="{% url 'niko_niko_calendar:view_calendar' %}" title="View Niko-niko calendar">
                                <span class="fa fa-calendar"></span> Niko^2 cal.
                            </a>
                        </li>
                    {% endif %}
                    <li role="presentation" {% if url_namespace == "slideshow" %}class="active"{% endif %}>
                        <a href="{% url 'slideshow:view' %}" title="Slideshow">
                            <span class="fa fa-area-chart"></span> Slideshow
                        </a>
                    </li>
                    {% if member %}
                        <li role="presentation" {% if url_namespace == "forecaster" %}class="active"{% endif %}>
                            <a href="{% url 'forecaster:index' %}" title="Forecasts">
                                <span class="fa fa-cloud"></span> Forecasts
                            </a>
                        </li>
                        <li role="presentation" {% if url_namespace == "visitors" %}class="active"{% endif %}>
                            <a href="{% url 'visitors:view_list' %}" title="Visitors">
                                <span class="fa fa-smile-o"></span> Visitors
                            </a>
                        </li>
                        <li role="presentation" {% if url_name == "view_hourly_rates" %}class="active"{% endif %}>
                           <a href="{% url 'hourly_rates:view_hourly_rates' %}" title="View available hourly rates">
                               <span class="fa fa-usd"></span> HRs
                           </a>
                        </li>
                        {% if member.has_trello_credentials %}
                            <li role="presentation" {% if url_name == "fetch_boards" %}class="active"{% endif %}>
                                <a href="{% url 'fetch:fetch_boards' %}" title="Fetch all boards">
                                    <span class="fa fa-download"></span>
                                </a>
                            </li>
                        {% endif %}
                    {% endif %}
                    {% with member=request.user.member %}
                        {% if member.is_developer %}
                            {% async_include "base/components/header/last_comments.html" html__tag="li" request__frequency=820 %}

                            {% async_include "base/components/header/last_cards_in_development.html" member=member html__tag="li" request__frequency=800 %}

                            {% async_include "base/components/header/last_notifications.html" member=member html__tag="li" request__frequency=620 %}
                        {% endif %}
                    {% endwith %}
                    <li class="dropdown">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" title="Logout">
                          <span class="fa fa-sign-out"></span> <span class="caret"></span>
                      </a>
                      <ul class="dropdown-menu dropdown-menu-right">
                          <li><a href="{% url 'base:logout' %}" title="Confirm logout">Confirm logout</a></li>
                      </ul>
                    </li>
                {% else %}
                    <li role="presentation" {% if url_name == "login" %}class="active"{% endif %}>
                        <a href="{% url 'base:login' %}" title="User login">
                            Login
                        </a>
                    </li>
                    <li role="presentation" {% if url_name == "signup" %}class="active"{% endif %}>
                        <a href="{% url 'members:signup' %}" title="User signup">
                            Signup as member
                        </a>
                    </li>
                {% endif %}
            </ul>
        {% endwith %}
    {% endif %}
</div>